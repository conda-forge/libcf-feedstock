{% set name = "libcf" %}
{% set version = "1.0.3" %}
{% set build = 8 %}

# ensure mpi is defined (needed for conda-smithy recipe-lint)
{% set mpi = mpi or 'nompi' %}

{% if mpi == 'nompi' %}
# prioritize nompi variant
{% set build = build + 100 %}
{% endif %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/CDAT/libcf/archive/1.0.3.tar.gz
  sha256: bf8102f55489fe96cd98e365e0e013837396c84a8c47c8a4eb15ef627817c1c9

build:
  number: {{ build }}
  skip: True  # [win]

  # add build string so packages can depend on
  # mpi or nompi variants explicitly:
  # `libcf * mpi_mpich_*` for mpich
  # `libcf * mpi_*` for any mpi
  # `libcf * nompi_*` for no mpi

  {% if mpi != 'nompi' %}
  {% set mpi_prefix = "mpi_" + mpi %}
  {% else %}
  {% set mpi_prefix = "nompi" %}
  {% endif %}
  string: "{{ mpi_prefix }}_py{{ CONDA_PY }}h{{ PKG_HASH }}_{{ build }}"

requirements:
  build:
    - {{ compiler('c') }}
  host:
    - python
    - libnetcdf
    - libnetcdf * {{ mpi_prefix }}_*
    - libblas 3.8.0 *openblas
    - libcblas 3.8.0 *openblas
    - curl >=7.44.0,<8
    - libuuid
  run:
    - python
    - libnetcdf * {{ mpi_prefix }}_*
    - curl >=7.44.0,<8
    - libuuid
    - libblas 3.8.0 *openblas
    - libcblas 3.8.0 *openblas
test:
  imports:
    - pycf
    - pycf.libCFConfig

about:
  home: http://www.unidata.ucar.edu/software/libcf/
  license: 'UCAR/UNIDATA'
  license_file: 'COPYRIGHT'
  summary: 'LibCF library access data files in accordance with the CF Conventions.'
  description: |
    By using libcf, a data producer can produce files that conform to the CF
    standards, without having to write netCDF code to create and decode all
    the attributes that the CF convention uses to store meta-data. A data consumer
    can use libcf to read any file which conforms to the CF conventions; the
    file does not need to be created with libcf to be read by libcf
  dev_url: https://sourceforge.net/projects/libcf/

extra:
  recipe-maintainers:
    - dnadeau4
    - doutriaux1
    - xylar
    - downiec
    - muryanto1
    - jasonb5
